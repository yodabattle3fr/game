<!DOCTYPE html>
<html>
<head>
  <title>Multiplayer Coin Game</title>
  <style>
    body { background:#111; margin:0; overflow:hidden; }
    canvas { background:#222; display:block; margin:auto; }
    #ownerPanel {
      display:none;
      position:absolute;
      top:10px; right:10px;
      background:rgba(255,255,255,0.1);
      padding:10px;
      border-radius:10px;
      color:#fff;
    }
    button { margin:3px; }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="600"></canvas>

  <div id="ownerPanel">
    <h3>Owner Panel</h3>
    <button onclick="sendOwner('instawin')">Insta Win</button>
    <button onclick="sendOwner('addcoins')">+10 Coins</button>
    <button onclick="sendOwner('spawn20')">Spawn 20 Coins</button>
  </div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const ws = new WebSocket("ws://localhost:3000"); // Change to server IP when hosted
let me = null;
let players = {};
let coins = [];

ws.onmessage = e => {
  const data = JSON.parse(e.data);

  if (data.type === "init") {
    me = data.id;
    players = data.players;
    coins = data.coins;
  }

  if (data.type === "state") {
    players = data.players;
    coins = data.coins;
  }

  if (data.type === "gameover") {
    alert("Winner: " + data.winner.color);
  }
};

function draw() {
  ctx.clearRect(0,0,800,600);
  // coins
  ctx.fillStyle="gold";
  coins.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x,c.y,8,0,Math.PI*2);
    ctx.fill();
  });
  // players
  for (let id in players){
    let p = players[id];
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x,p.y,20,20);
    ctx.fillStyle="#fff";
    ctx.fillText(p.coins,p.x,p.y-5);
  }
  requestAnimationFrame(draw);
}
draw();

// movement
window.addEventListener("keydown", e=>{
  let p = players[me];
  if(!p) return;
  if(e.key==="ArrowUp") p.y-=10;
  if(e.key==="ArrowDown") p.y+=10;
  if(e.key==="ArrowLeft") p.x-=10;
  if(e.key==="ArrowRight") p.x+=10;

  ws.send(JSON.stringify({ type:"move", x:p.x, y:p.y }));

  // coin check
  coins.forEach(c=>{
    if(Math.abs(p.x-c.x)<15 && Math.abs(p.y-c.y)<15){
      ws.send(JSON.stringify({ type:"pickup", coinId:c.id }));
    }
  });
});

// === Owner Panel unlock ===
window.addEventListener("keydown", e=>{
  if(e.shiftKey && e.key.toLowerCase()==="o"){
    const pass = prompt("Owner password?");
    if(pass==="mySecret123"){
      document.getElementById("ownerPanel").style.display="block";
    }
  }
});

function sendOwner(action){
  ws.send(JSON.stringify({ type:"owner", action, secret:"mySecret123" }));
}
</script>
</body>
</html>
